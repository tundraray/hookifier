# Hookifier v1.22

Hookifier - это Expert Advisor для MetaTrader 5, который отправляет уведомления о торговых событиях на веб-хуки в режиме реального времени.

## Основные возможности

- **Полное отслеживание торговых событий**: открытие/закрытие позиций, создание/активация/отмена ордеров
- **Оптимизированная дедупликация**: предотвращает дублирование событий с использованием хэш-таблиц и бинарного поиска O(log n)
- **Надежная отправка**: автоматические повторные попытки с настраиваемыми параметрами
- **Модульная архитектура**: разделение на специализированные модули для удобства поддержки
- **Подробное логирование**: детальная информация о всех операциях и ошибках
- **Гибкие настройки**: фильтры событий, настройки надежности, отладочная информация

## Структура проекта

```
hookifier/
├── Hookifier.mq5           # Основной файл Expert Advisor
├── dedup.mqh              # Модуль дедупликации событий
├── json_builder.mqh       # Построение JSON для веб-хуков
├── logger.mqh             # Система логирования
├── utils.mqh              # Вспомогательные функции
├── webhook_client.mqh     # HTTP клиент для веб-хуков
├── compile.ps1            # PowerShell скрипт компиляции
└── README.md              # Документация
```

## Установка

1. Скопируйте все файлы в папку `MQL5/Experts/hookifier/`
2. Откройте MetaEditor и скомпилируйте `Hookifier.mq5`
3. Или используйте PowerShell скрипт для автоматической компиляции:
   ```powershell
   .\compile.ps1
   ```

## Настройка

### Основные параметры

- **SendToWebhook**: включить/выключить отправку на веб-хук
- **WebhookURL**: URL вашего веб-хука для получения уведомлений
- **WebhookTimeout**: таймаут HTTP запросов (мс)

### Фильтры событий

- **EnableOrderEvents**: события по ордерам (создание, активация, отмена)
- **EnablePositionEvents**: события по позициям (открытие, закрытие)
- **EnableSltpEvents**: события обновления SL/TP

### Настройки надежности

- **MaxRetries**: количество повторных попыток при ошибках
- **RetryDelay**: задержка между попытками (мс)
- **EnableDedup**: включить подавление дубликатов
- **DedupWindowMs**: окно дедупликации (мс)

## Типы событий

### Позиции
- **OPEN**: открытие новой позиции
- **CLOSE**: полное закрытие позиции
- **PARTIAL_CLOSE**: частичное закрытие позиции
- **POSITION_SLTP_UPDATE**: изменение SL/TP позиции

### Ордера
- **PENDING**: создание отложенного ордера
- **ACTIVATED**: активация отложенного ордера
- **CANCELED**: отмена ордера
- **REJECTED**: отклонение ордера брокером
- **EXPIRED**: истечение срока ордера
- **PARTIAL**: частичное исполнение ордера
- **ORDER_SLTP_UPDATE**: изменение SL/TP ордера

## Формат JSON

Все события отправляются в стандартизированном JSON формате:

```json
{
  "event": "OPEN",
  "ticket": 123456,
  "timestamp": "2025-08-28T13:08:33Z",
  "account": 12345,
  "broker": "Broker Name",
  "schema_version": "1.0",
  "ea_version": "1.22",
  "symbol": "EURUSD",
  "sector": "SECTOR_CURRENCY",
  "position_id": 123456,
  "type": "BUY",
  "volume": 0.10,
  "price": 1.0950,
  "profit": 15.50,
  "swap": 0.00,
  "sl": 1.0900,
  "tp": 1.1000,
  "comment": ""
}
```

## Компиляция

### Автоматическая компиляция (PowerShell)

```powershell
# Автоматическое определение файла
.\compile.ps1

# Явное указание файла
.\compile.ps1 -SourceFile "Hookifier.mq5"

# Создает версионные копии: Hookifier-1.22.ex5
```

### Ручная компиляция

1. Откройте MetaEditor
2. Откройте файл `Hookifier.mq5`
3. Нажмите F7 или Compile

## Технические особенности

### Оптимизированная дедупликация
- Использует DJB2 хэш-алгоритм для быстрого сравнения
- Бинарный поиск O(log n) вместо линейного O(n)
- Автоматическая очистка устаревших записей
- Настраиваемый размер кэша (по умолчанию 1024 записи)

### Модульная архитектура
- **dedup.mqh**: класс DedupManager для предотвращения дубликатов
- **json_builder.mqh**: класс JsonBuilder для построения JSON
- **logger.mqh**: централизованное логирование с уровнями
- **utils.mqh**: кэширование и вспомогательные функции
- **webhook_client.mqh**: HTTP клиент с обработкой ошибок

### Обработка ошибок
- Подробные сообщения об ошибках HTTP
- Автоматические повторные попытки
- Логирование всех операций
- Валидация данных перед отправкой

## Версии

### v1.22 (текущая)
- Оптимизированная дедупликация с бинарным поиском
- Модульная архитектура с отдельными .mqh файлами
- Исправлены названия полей JSON (sl/tp вместо stop_loss/take_profit)
- Добавлена подробная русская документация
- PowerShell скрипт для автоматической компиляции
- Увеличен размер кэша дедупликации до 1024 записей

## Требования

- MetaTrader 5 (build 3815+)
- Разрешение на WebRequest для вашего URL
- PowerShell 5.1+ (для автоматической компиляции)

## Лицензия

Copyright 2025, Lavara Software Ltd.